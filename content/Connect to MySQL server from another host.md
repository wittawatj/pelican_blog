Title: Connect to MySQL server from another host 
Date: 2008-05-13 03:09:00
Tags:  
Slug: Connect to MySQL server from another host 


ปกติแล้วที่เคยทำมาจะใช้ apache, php กับ mysql บนเครื่องเดียวกัน พอเขียน php ก็จะใช้ mysql_connect('localhost','user','pass'); ซึ่งตรง parameter แรกจะเป็น localhost ตลอด<br /><br />แต่ครั้งนี้เป็นครั้งแรกที่ต้อง connect ไปที่ mysql บนเครื่องอื่น ทำให้มีเรื่องยุ่งที่ไม่เคยเจอนิดๆ คือ ปกติ MySQL server จะไม่รับ connection จากข้างนอกอยู่แล้ว เห็นได้จากการใช้คำสั่ง<br /><br />netstat -an | grep "LISTEN"<br /><br />บรรทัดบนๆ จะมีบรรทัดนึงได้ประมาณนี้<br /><br /><pre>tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN</pre><br /><br />บรรทัดนี้กำลังบอกว่า host นี้กำลังเปิด port 3306 (port ของ MySQL) สำหรับแค่เครื่องตัวเองเท่านั้น (ตรงนี้สรุปเอง) เพราะมันเป็น 127.0.0.1 ซึ่งเครื่องอื่นจะล็อกอินเข้าดาต้าเบสไม่ได้ แต่จะล็อกอินจากเครื่องนี้เองได้<br /><br />วิธีทำให้เข้าจากเครื่องอื่นได้ (วิธีนี้ลองทำกับ Ubuntu 8.04 นะ linux รุ่นอื่นไม่รู้ )คือ<br /><ol><li>backup ไฟล์ /etc/mysql/my.cnf ไว้ก่อน<br /></li><li>แก้ไฟล์ /etc/mysql/my.cnf โดยหาบรรทัดที่มีคำว่า bind-address</li><li>เติม # ไปข้างหน้า เพื่อ comment ออก อธิบาย: ถ้ามีบรรทัดนี้อยู่จะทำให้ MySQL listen เฉพาะ localhost เท่านั้น เข้าใจว่าเข้าทำไว้เพื่อให้มันปลอดภัย</li><li>บันทึกไฟล์ แล้วปิดได้</li><li>restart MySQL server ซะใหม่ โดย sudo /etc/init.d/mysql restart (วิธีrestart service ของ linux แต่ละรุ่นไม่เหมือนกันนะ)</li></ol>พอทำเสร็จเราก็จะเข้าดาต้าเบสจากเครื่องอื่นได้ ถ้าลอง netstat -an | grep "LISTEN" อีกทีนึงบรรทัดที่บอกไปข้างบนจะเปลี่ยนเป็นแบบนี้:<br /><br /><pre>tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN</pre><br /><br />จะเห็นว่าตรง ip จะเป็น 0.0.0.0 แล้ว ไม่ใช่ 127.0.0.1 ที่เป็น loopback address สำหรับเครื่องตัวเอง
