Title: Matlab: ผลคูณของผลบวก 
Date: 2011-01-09 10:53:36
Tags: matlab 
Slug: Matlab: ผลคูณของผลบวก 


สมมติว่าเราอยากหาคำตอบของ (1+2+...+10)*(11+12+...+20)*...*(91+92+...+100) ในภาษา Java น่าจะเขียนได้ประมาณนี้ 

	:::Java
	int product = 1;
	for(int i=0; i&amp;lt;=9; ++i){
	   int sum = 0;
	   for(int j=i*10 + 1; j&amp;lt;= (i+1)*10; ++j){
	      sum += j;
	   }
	   product *= sum;
	}


ถ้าเขียนแบบนี้ใน Matlab แบบดื้อๆเลยจะช้า เหตุผลว่าทำไมถึงช้านั้นอธิบายกันได้ยืดยาว แต่พูดง่ายๆหลักๆคือ Matlab ใช้ interpreter แปลว่า Matlab อ่าน code ทีละบรรทัดแล้วคิดคำตอบให้ ในปัญหานี้เราต้องการหาผลคูณของผลบวก ถ้าดูดีๆจะเห็นว่าส่วนที่บวกกันเช่น (1+2+...+10) หรือ (11+12+...+20) ไม่จำเป็นต้องทำเรียงกัน กล่าวคือทำมันพร้อมกันเลยก็ได้ถ้าเรามีหลาย CPU แล้วค่อยเอามาคูณกันทีหลัง แต่ถ้าเราเขียนใช้ loop แบบข้างบน Matlab ไม่มีทางรู้ว่า การบวกกันแต่ละส่วนสามารถทำพร้อมๆกันได้ มันก็บวกเรียงกันไป ทำให้ได้ผลช้ากว่าการบวกพร้อมๆกัน แน่นอนว่าปัญหาข้างต้นมันเป็นแค่ตัวอย่างเล็กๆ เขียนด้วย loop หรือไม่ ก็ความเร็วไม่ต่างกัน

แล้วเขียนแบบไม่ใช้ loop ทำยังไง? วิธีหนึ่งที่ใช้แก้ปัญหาข้างต้นได้คือ

	prod(sum(reshape(1:100, 10, 10 ) , 1))

อธิบายได้เป็นส่วนๆดังนี้
<ul>
	<li>1:100 คือ สร้าง vector ที่มีเลข 1 ถึง 100 ขึ้นมา</li>
	<li>reshape(A, m, n) คือเปลี่ยนรูปร่างของ matrix โดยอ่านเลขจากบนลงล่าง จากซ้ายไปขวา แล้วนำมาเรียงใหม่ให้เป็น matrix ขนาด m x n ในตัวอย่างข้างบนคือ reshape(1:100, 10, 10) ก็แปลว่านำเลข 1 ถึง 100 มาเรียงใส่ matrix ขนาด 10 x 10 จากบนลงล่าง จากซ้ายไปขวา จะได้ว่าคอลัมน์แรกเป็นเลข 1 ถึง 10 คอลัมน์สองเป็นเลข 11 ถึง 20 ...</li>
	<li>sum(A, 1) คือหาผลบวกของตัวเลขใน matrix A เลข 1 ใน argument ที่สองแปลว่าให้บวกจากบนลงล่าง ผลที่ได้จะเป็น row vector จากตัวอย่าง sum(reshape(1:100, 10, 10 ) , 1) จึงได้เป็น row vector โดยที่ช่องแรกคือ (1+2+...+10) ช่องที่ 2 คือ (11+12+...+20) ...</li>
	<li>prod(V) เอาไว้หาผลคูณใน vector V จาก code ข้างบน prod(sum(reshape(1:100, 10, 10 ) , 1)) ก็คือการหาผลคูณของผลบวก แบบที่เราอยากได้</li>
</ul>
การเขียนแบบไม่ใช้ loop แบบข้างบนนอกจากจะสั้นแล้ว ยังทำให้ Matlab รู้ว่าเราต้องการบวก แต่ละคอลัมน์แยกกัน ซึ่งถ้าเรามี matrix ที่ใหญ่ระดับหนึ่ง Matlab จะเริ่มใช้หลาย CPU ให้ (ถ้า matrix ไม่ใหญ่มาก Matlab จะไม่ใช้หลาย CPU เนื่องจากไม่คุ้มค่า overhead)
