Title: Error อย่างไม่คาดคิดจากไฟล์ใน classpath  
Date: 2009-08-20 14:50:00
Tags: java 
Slug: Error อย่างไม่คาดคิดจากไฟล์ใน classpath  


ในการเขียนโปรแกรม Java คำว่า classpath หมายถึงตำแหน่งที่จะให้ Java ไปหา class เพื่อเรียกใช้ในโปรแกรม ปกติแล้วเวลาเขียนโปรแกรม Java เสร็จก็มักจะสร้างเป็น JAR เพื่อให้พกพาได้ง่าย แล้วเวลาเรียกใช้ก็สร้าง shell script เพื่อเรียก jar อีกที จะได้เรียก script นั้นแล้วก็รันเลย ต่อไปนี้เป็นตัวอย่างคำสั่งใน script ที่มักใช้บ่อย

[bash]java  -cp &quot;lib/*:myProgram.jar&quot; my.package.name.MyMain[/bash]

คำสั่งข้างบนคือ สั่งรัน class ชื่อ MyMain ซึ่งอยู่ใน package my.package.name โดยที่ MyMain นี้อยู่ใน JAR ที่เราแพคมาแล้ว -cp คือการกำหนด classpath ว่าให้ Java ไปหา class เพื่อรันที่ไฟล์ในโฟลเดอร์ lib (เขียนว่า lib/* แปลว่า ทุกไฟล์ในโฟลเดอร์ lib) รวมทั้ง class ที่อยู่ใน myProgram.jar ด้วย จะเห็นว่าการกำหนด path ของแต่ละตำแหน่งต้องขั้นด้วย : (colon) รูปแบบการกำหนด classpath อาจต่างไปเล็กน้อยสำหรับใน Windows คำสั่งข้างบนใช้กับ Linux

ที่เขียนโพสนี้ไม่ได้ตั้งใจจะอธิบายเรื่อง classpath แต่จะจดความไม่รู้ของตัวเอง ที่ทำให้ต้องนั่งเสียเวลาหาเป็นชั่วโมง :( เรื่องมีอยู่ว่ามีเหตุผลที่ต้องแก้ code พอแก้เสร็จก็ upload JAR ขึ้นไปบน server เพื่อจะรันตามปกติ ที่นี้ตอนรันปรากฏว่า output ดันเป็นเหมือนกับตอนที่ยังไม่แก้ code เลย ทั้งๆที่ก็แก้แล้ว ไล่หาอยู่นาน ทำยังไงมันก็ไม่เปลี่ยน

ปัญหาเป็นอะไรที่เล็กมา คือ JAR ที่อัพโหลดไปดันไปอยู่ผิดที่ แทนที่จะอยู่<strong>แค่</strong> (เน้นคำว่า"แค่") นอกโฟลเดอร์ lib มันดันไปอยู่ในโฟลเดอร์ lib ด้วย กลายเป็นว่ามี JAR 2 อันซึ่งอยู่ใน classpath ทั้งคู่เลย ซึ่งดูเผินๆไม่น่าจะมีอะไร Java ก็เลือกอันไหนก็ได้ แต่เรื่องของเรื่องคือ <strong>Java เลือกใช้อันที่อยู่ในโฟลเดอร์ lib </strong>ครับ แล้วเผอิญว่าอันนั้นมันเป็นอันเก่า ที่ยังไม่แก้...!

บทเรียน: โปรแกรมรันได้ไม่ได้แปลว่า classpath ถูกต้องแล้ว วาง JAR ดีๆอย่าเบลอ
